FROM maven:3.8.6-openjdk-18-slim AS builder
WORKDIR /opt/app
COPY . .
RUN mvn -e clean verify
FROM openjdk:18-slim
WORKDIR /opt/app
COPY --from=builder /opt/app/target/*.jar ./
EXPOSE 80
COPY /src/main/resources/application-prod.properties /opt/app/application-prod.properties
ENTRYPOINT java -Djava.security.egd=file:/dev/./urandom -jar /opt/app/*.jar --spring.config.location=/opt/app/application-prod.properties